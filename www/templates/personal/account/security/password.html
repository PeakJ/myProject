<ion-view hide-nav-bar="true">
    <ion-header-bar class="cdfg-common-title" align-title="center">
        <button ng-click="goBack();" class="button button-clear title-back-button"></button>
        <span class="title">登录密码</span>
    </ion-header-bar>
    <ion-content class="cdfg-background-white">
        <!-- 表单验证用 -->
        <form name="passwordForm" ng-controller="PasswordFormController">
            <!--上方步骤提示栏-->
            <div class="row cdfg-security-sign">
                <!--绑定scope中的step，根据step显示当前步骤背景为红色-->
                <div class="cdfg-security-col" ng-class="{'check': 'cdfg-password-active'}[mode.step]">1
                    <div class="text">验证身份</div>
                </div>
                <div class="col cdfg-padding cdfg-security-arrow">
                    <img ng-src="img/icon-right.png">
                </div>
                <div class="cdfg-security-col" ng-class="{'password': 'cdfg-password-active'}[mode.step]">2
                    <div class="text">设置密码</div>
                </div>
                <div class="col cdfg-padding cdfg-security-arrow">
                    <img ng-src="img/icon-right.png">
                </div>
                <div class="cdfg-security-col" ng-class="{'done': 'cdfg-password-active'}[mode.step]">3
                    <div class="text">完成</div>
                </div>
            </div>
            <!--边框-->
            <div class="cdfg-password-panel padding">
                <!--验证部分-->
                <div ng-if="mode.step=='check'">
                    <label for="selectMethod"> 请选择验证身份方式 </label><br>
                    <!--下拉选项，选择手机或者邮箱验证 -->
                    <select id="selectMethod" ng-model="mode.phoneOrEmail">
                        <option value="phone">已验证手机</option>
                        <option value=email>已验证邮箱</option>
                    </select>
                    <!--手机验证-->

                    <div ng-if="mode.phoneOrEmail=='phone'">
                        <p>
                            已验证手机：{{phone.text}}
                        </p>
                        <button ng-disabled="phone.locker" ng-click="getPassCode()">
                            {{phone.buttonText}} <span ng-if="phone.timer!=0">({{phone.timer}})</span>
                        </button>
                        <div class="cdfg-relative" reg-is-empty>

                            <input name="validateCode" pattern="^\d{6}$" required type="tel" maxlength="6"
                                   ng-class="{'true':'cdfg-input-error'}[!passwordForm.validateCode.$valid && validate]"
                                   class="valudateCode" ng-model="phone.inputCode"
                                   placeholder="{{validate?'请输入正确的手机验证码':'手机验证码'}}"/>
                        </div>
                    </div>
                    <!--邮箱验证-->
                    <div ng-if="mode.phoneOrEmail=='email'">
                        <p>
                            已验证邮箱：{{email.text}}
                        </p>
                        <button ng-disabled="email.locker" ng-click="getPassEmail()">
                            {{email.buttonText}} <span ng-if="email.timer!=0">({{email.timer}})</span>
                        </button>
                    </div>
                    <!--显示联网取到的电话号码和邮箱-->
                    <button ng-disabled="(!passwordForm.validateCode.$valid && mode.phoneOrEmail == 'phone')||
                    (email.text == '无'&& mode.phoneOrEmail == 'email')"
                            ng-click="goNextStep()" class="button button-block button-assertive">下一步
                    </button>
                </div>
                <div ng-if="mode.step=='password'||mode.step=='done'">

                    <!--手机修改-->
                    <div ng-if="mode.phoneOrEmail=='phone'">
                        <div class="cdfg-relative" reg-is-empty>

                            <input name="password" type="password" ng-model="phone.password" required
                                   class="valudateCode"
                                   pattern="^(?!\D+$)(?![^a-z]+$)[a-zA-Z\d]{6,}$"
                                   ng-class="{'true':'cdfg-input-error'}[!passwordForm.password.$valid && validate]"
                                   placeholder="密码为6位以上的数字和字母组成"/>
                        </div>
                        <div class="cdfg-relative" reg-is-empty>

                            <input name="repassword" type="password" ng-model="phone.repassword" required
                                   class="valudateCode"
                                   ng-pattern="{{phone.password}}"
                                   ng-class="{'true':'cdfg-input-error'}[!passwordForm.repassword.$valid && validate]"
                                   placeholder="{{validate?'两次输入密码不一致':'请输入确认密码'}}"/>
                        </div>
                    </div>
                    <!--邮箱修改-->
                    <div ng-if="mode.phoneOrEmail=='email'">
                        <p>
                            {{email.text}}
                        </p>

                        <p>
                            验证信息已发到您的邮箱中，请查看邮箱信息修改密码。
                        </p>
                    </div>

                    <button ng-disabled="passwordForm.repassword.$error.required || passwordForm.password.$error.required"
                            class="button button-block button-assertive" ng-click="submitPassword()">确定
                    </button>
                </div>

            </div>
        </form>
    </ion-content>
</ion-view>