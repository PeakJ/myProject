<!-- 个人中心->订单详情页面  by geshuo 2015/6/29 -->
<ion-view hide-nav-bar="true">
    <ion-header-bar class="cdfg-common-title" align-title="center">
        <button ng-click="goBack();" class="button button-clear title-back-button"></button>
        <span class="title">订单详情</span>
    </ion-header-bar>
    <ion-content class="cdfg-personal-order-list-main-bg" ng-class="{'has-footer':hasFooter}"
                 delegate-handle="orderDetailHandle">
        <ion-refresher on-refresh="loadData()"></ion-refresher>
        <!-- 物流、提货信息 -->
        <div class="light-bg margin-top-15">
            <div class="cdfg-order-detail-title">
                <span>订单号：</span>
                <span ng-bind="orderDetailData.code"></span>
                <span class="cdfg-fr" ng-bind="orderDetailData.statusText"></span>
            </div>

            <!-- 快递到家：物流信息 -->
            <div class="cdfg-order-detail-express row row-no-padding"
                 ng-if="orderDetailData.orderType==1 && orderDetailData.expressInfo"
                 ng-click="toOrderExpress(orderDetailData.id)">
                <div class="icon-express">
                    <img src="img/icon-express.png">
                </div>
                <div class="express-info">
                    <span ng-bind="orderDetailData.expressInfo"></span>
                    <br/>
                    <span ng-bind="orderDetailData.expressUpdateTime"></span>
                </div>
                <div class="right-icon">
                    <img src="img/icon-right.png"/>
                </div>

            </div>

            <div class="cdfg-order-detail-express row row-no-padding"
                 ng-if="!hasExpressDetail&&(orderDetailData.status==DELIVERED||orderDetailData.status==DEAL)">
                <div class="icon-express">
                    <img src="img/icon-express.png">
                </div>
                <div class="express-info">
                    <span>物流单号：</span>
                    <span ng-bind="orderDetailData.awbNo"></span>
                    <br/>
                    <span>信息来源：</span>
                    <span ng-bind="orderDetailData.lcName"></span>
                </div>
            </div>

        </div>

        <div class="light-bg">
            <!-- 快递到家：收货信息 -->
            <div class="cdfg-order-detail-customer" ng-if="orderDetailData.orderType==1"
                 ng-class="{'margin-top':orderDetailData.expressInfo || !hasExpressDetail}">
                <div class="icon-left">
                    <img src="img/icon-location.png"/>
                </div>
                <div class="info">
                    <span class="cdfg-font-general-dark">收货信息：</span>
                    <span class="cdfg-font-general-dark" ng-bind="orderDetailData.recName"></span>
                    <span class="cdfg-font-general-dark cdfg-fr" ng-bind="orderDetailData.recMobile"></span>
                </div>
                <span class="cdfg-font-sub-light" ng-bind="orderDetailData.reciGeoName+orderDetailData.recAddr"></span>
                <br/>
                <span class="cdfg-font-sub-light">身份证号：</span>
                <span class="cdfg-font-sub-light" ng-bind="orderDetailData.idCardNo"></span>
            </div>

            <!--商城商品-->
            <div class="cdfg-order-detail-goods"
                 ng-class="{'cdfg-order-detail-margin':orderDetailData.mallItems.length > 3, 'cdfg-order-detail-padding':orderDetailData.mallItems.length <= 3}"
                 ng-repeat="goods in orderDetailData.mallItems" ng-if="$index<3||showAllMallItems"
                 ng-click="toGoodsDetail(goods.prodId)">
                <span class="cdfg-gift-text gift" ng-if="goods.type==2">赠品</span>
                <img ng-src="{{goods.mainPic | imgUrlFilter}}"class="cdfg-default-hy"/>

                <div class="cdfg-orderlist-title" ng-bind="goods.prodName"></div>
                <div class="price">
                    <span>￥</span>
                    <span ng-bind="goods.transPrice"></span>

                    <div class="goods-count">
                        x
                        <span ng-bind="goods.num"></span>
                    </div>
                </div>
            </div>


            <!-- 展开按钮 -->
            <div class="cdfg-order-detail-show"
                 ng-click="showOrHideGoods(TYPE_MALL)"
                 ng-if="!showAllMallItems&&orderDetailData.mallItems.length>3">
                <span>
                    还有<span ng-bind="orderDetailData.mallItems.length-3"></span>件
                </span>
                <img src="img/icon-goods-show.png"/>
            </div>

            <!-- 收起按钮 -->
            <div class="cdfg-order-detail-show"
                 ng-click="showOrHideGoods(TYPE_MALL)" ng-if="showAllMallItems">
                <span>收起</span>
                <img src="img/icon-goods-hide.png"/>
            </div>
        </div>


        <!-- 免税店：提货人信息 -->
        <div class="cdfg-order-detail-customer-info light-bg"
             ng-class="{'margin-top':orderDetailData.orderType==TYPE_ALL}"
             ng-if="orderDetailData.orderType==TYPE_SHOP||orderDetailData.orderType==TYPE_ALL">
            <div class="icon-person">
                <img src="img/icon-footmenu-personal-pressed.png"/>
            </div>
            <div class="info">
                <span>提货人信息：</span>
                <span ng-bind="orderDetailData.selfTakingName"></span>
                <span class="cdfg-fr" ng-bind="orderDetailData.selfTakingMobile"></span>
            </div>
            <span class="passport">护照号：</span>
            <span class="passport" ng-bind="orderDetailData.selfTakingPassportNo"></span>

        </div>

        <!-- 免税店：提货信息 -->
        <div class="cdfg-order-detail-leave light-bg"
             ng-if="orderDetailData.orderType==TYPE_SHOP|| orderDetailData.orderType==TYPE_ALL"
             ng-click="checkAddress(orderDetailData.id)">
            <button>免税店自提</button>
            <br/>

            <div class="location-icon">
                <img src="img/icon-location.png"/>
            </div>

            <div class="leaving-info">
                <span class="location">出境地点：</span>
                <span class="location" ng-bind="orderDetailData.storeName"></span>
                <br/>
                <span class="date">提货时间：</span>
                <span class="date" ng-bind="orderDetailData.selfTakingTime"></span>
            </div>
            <div class="right-icon">
                <img src="img/icon-right.png"/>
            </div>
        </div>

        <!-- 免税店：店铺信息 -->
        <div class="cdfg-order-detail-shop" ng-click="toShopDetail(orderDetailData.storeId)"
             ng-class="{'margin-top':orderDetailData.orderType==TYPE_SHOP,'cdfg-personal-order-border-top':orderDetailData.orderType==TYPE_ALL}"
             ng-if="orderDetailData.orderType==TYPE_SHOP||orderDetailData.orderType==TYPE_ALL">
            <span ng-bind="orderDetailData.storeName"></span>
            <img src="img/icon-right.png"/>
        </div>

        <!--免税店商品-->
        <div class="light-bg">
            <!-- 商品信息 -->
            <div class="cdfg-order-detail-goods"
                 ng-class="{'cdfg-order-detail-margin':orderDetailData.shopItems.length > 3, 'cdfg-order-detail-padding':orderDetailData.shopItems.length <= 3}"
                 ng-repeat="goods in orderDetailData.shopItems" ng-if="$index<3||showAllShopItems"
                 ng-click="toGoodsDetail(goods.prodId)">
                <span class="cdfg-gift-text gift" ng-if="goods.type==2">赠品</span>
                <img ng-src="{{goods.mainPic | imgUrlFilter}}" class="cdfg-default-hy"/>

                <div class="cdfg-orderlist-title" ng-bind="goods.prodName"></div>
                <div class="price">
                    <span>￥</span>
                    <span ng-bind="goods.transPrice"></span>

                    <div class="goods-count">
                        x
                        <span ng-bind="goods.num"></span>
                    </div>
                </div>
            </div>

            <!-- 展开按钮 -->
            <div class="cdfg-order-detail-show"
                 ng-click="showOrHideGoods(TYPE_SHOP)"
                 ng-if="!showAllShopItems&&orderDetailData.shopItems.length>3">
                <span>
                    还有<span ng-bind="orderDetailData.shopItems.length-3"></span>件
                </span>
                <img src="img/icon-goods-show.png"/>
            </div>

            <!-- 收起按钮 -->
            <div class="cdfg-order-detail-show"
                 ng-click="showOrHideGoods(TYPE_SHOP)" ng-if="showAllShopItems">
                <span>收起</span>
                <img src="img/icon-goods-hide.png"/>
            </div>
        </div>

        <div class="light-bg padding-top">
            <!-- 金额相关 -->
            <div class="cdfg-order-detail-row">
                <span>商品金额</span>
                <span class="price-text" ng-bind="orderDetailData.prodFee | currency:'&yen;'"></span>
            </div>
            <div class="cdfg-order-detail-row">
                <span>+ 总运费</span>
                <span class="price-text" ng-bind="orderDetailData.deliverFee | currency:'&yen;'"></span>
                <span class="price-text">+</span>
            </div>
            <div class="cdfg-order-detail-row" ng-class="{'margin-bottom':orderDetailData.zmcardChargeFee==0}">
                <span>- 订单优惠</span>
                <span class="price-text"
                      ng-bind="orderDetailData.prodDiscountFee+orderDetailData.couponChargeFee | currency:'&yen;'"></span>
                <span class="price-text">-</span>
            </div>
            <div class="cdfg-order-detail-row margin-bottom" ng-if="orderDetailData.zmcardChargeFee!=0">
                <span>- 中免卡支付</span>
                <span class="price-text" ng-bind="orderDetailData.zmcardChargeFee | currency:'&yen;'"></span>
                <span class="price-text">-</span>
            </div>

            <div class="cdfg-personal-order-border-top cdfg-personal-order-border-bottom padding-top padding-bottom">
                <div class="cdfg-order-detail-total" style="text-align: right;">
                    <span class="margin-right cdfg-font-general-dark">实付金额：</span>
                    <span class="price-text" ng-bind="orderDetailData.realChargeFee | currency:'&yen;'"></span>
                </div>
                <div class="cdfg-order-detail-total padding-top-small" style="text-align: right;">
                    <span class="margin-right cdfg-font-sub-light">下单时间：</span>
                    <span class="cdfg-font-sub-light" ng-bind="orderDetailData.createdDate"></span>
                </div>
            </div>


            <div class="cdfg-order-detail-service">
                <button class="button button-small" ng-click="customerService()">
                    联系客服
                </button>
            </div>
        </div>

        <div class="cdfg-order-detail-pay-type">
            <span class="cdfg-font-second-light">支付方式</span>
            <span class="cdfg-font-general-dark" ng-bind="orderDetailData.payTypeText"></span>
        </div>

        <div class="light-bg" ng-if="orderDetailData.orderType==TYPE_MALL||orderDetailData.orderType==TYPE_ALL">
            <div class="cdfg-order-detail-invoice">
                <span class="cdfg-font-second-light">发票信息</span>
                <span class="cdfg-font-general-dark cdfg-fr" ng-bind="orderDetailData.invoiceStyleText"
                        ng-if="orderDetailData.invoiceTitle"></span>

                <span class="cdfg-font-general-dark cdfg-fr" ng-if="!orderDetailData.invoiceTitle">无</span>
            </div>
            <div class="cdfg-order-detail-invoice-type" ng-if="orderDetailData.invoiceTitle">
                <span class="cdfg-font-sub-light">发票类型：</span>
                <span class="cdfg-font-sub-light" ng-bind="orderDetailData.invoiceTypeText"></span>
                <br/>
                <span class="cdfg-font-sub-light">发票抬头：</span>
                <span class="cdfg-font-sub-light" ng-bind="orderDetailData.invoiceTitle"></span>
            </div>
            <div class="cdfg-order-detail-invoice">
                <span class="cdfg-font-general-dark" ng-bind="orderDetailData.deliverTime"></span>
            </div>
        </div>

        <!--<div class="cdfg-personal-order-border-top light-bg cdfg-personal-order-border-bottom padding-top"
             style="text-align: center;margin-bottom: 20px">
            <span class="cdfg-personal-order-font-small" style="font-weight: bold">猜你心动的商品</span>
            <div ng-include="'templates/product/link-product-list-template.html'"></div>
        </div>-->
    </ion-content>

    <ion-footer-bar class="cdfg-order-detail-border-top-light" ng-if="hasFooter">
        <!-- 快递到家订单 -->
        <div class="cdfg-personal-order-width-full" ng-if="orderDetailData.orderType==1">
            <!-- 待付款 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==NOT_PAY">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="cancelOrder(orderDetailData.id)">取消订单
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="payOrder(orderDetailData.id)">立即付款
                    </button>
                </div>
            </div>

            <!-- 待发货 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==PAYED">
                <div class="cdfg-order-detail-col-67 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="cancelOrder(orderDetailData.id)">取消订单
                    </button>
                </div>
            </div>

            <!-- 已发货 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==DELIVERED ">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="toOrderExpress(orderDetailData.id)">查看物流
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="confirmReceive(orderDetailData.id)">确认收货
                    </button>
                </div>
            </div>

            <!-- 交易完成 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==DEAL&&orderDetailData.comment==0">
                <div class="cdfg-order-detail-bottom-btn-container cdfg-order-detail-col-34">
                    <button class="button cdfg-order-detail-btn-negative" ng-if="showAfterSale"
                            ng-click="refundOrder(orderDetailData.id)">返修/退货
                    </button>
                </div>
                <div class="cdfg-order-detail-bottom-btn-container cdfg-order-detail-col-33">
                    <button class="button cdfg-order-detail-btn-remark"
                            ng-click="evaluateOrder(orderDetailData.id)">评价晒单
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container"
                     ng-if="orderDetailData.comment!=0">
                </div>

                <div class="cdfg-order-detail-bottom-btn-container cdfg-order-detail-col-33">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="buyAgain()">再次购买
                    </button>
                </div>
            </div>

            <!-- 已评价 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==DEAL&&orderDetailData.comment==1">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative" ng-if="showAfterSale"
                            ng-click="refundOrder(orderDetailData.id)">返修/退货
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="buyAgain()">再次购买
                    </button>
                </div>
            </div>
        </div>

        <!-- 免税店自提自提订单 -->
        <div class="cdfg-personal-order-width-full" ng-if="orderDetailData.orderType==TYPE_SHOP">
            <!-- 待付款 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==NOT_PAY">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="cancelOrder(orderDetailData.id)">取消订单
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="payOrder(orderDetailData.id)">立即付款
                    </button>
                </div>
            </div>

            <!-- 待提货 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==PAYED">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="cancelOrder(orderDetailData.id)">取消订单
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="checkAddress(orderDetailData.id)">查看自提点
                    </button>
                </div>
            </div>

            <!-- 交易完成 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==DEAL">
                <div class="cdfg-order-detail-col-34 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container"
                     ng-if="orderDetailData.comment!=0"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container"
                     ng-if="orderDetailData.comment==0">
                    <button class="button cdfg-order-detail-btn-negative"
                            ng-click="evaluateOrder(orderDetailData.id)">评价晒单
                    </button>
                </div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="buyAgain()">再次购买
                    </button>
                </div>
            </div>

            <!-- 已评价 -->
            <div class="row row-no-padding" ng-if="orderDetailData.status==REMARKED">
                <div class="cdfg-order-detail-col-67 cdfg-order-detail-bottom-btn-container"></div>
                <div class="cdfg-order-detail-col-33 cdfg-order-detail-bottom-btn-container">
                    <button class="button button-assertive cdfg-order-detail-btn-positive"
                            ng-click="buyAgain()">再次购买
                    </button>
                </div>
            </div>
        </div>
    </ion-footer-bar>
</ion-view>